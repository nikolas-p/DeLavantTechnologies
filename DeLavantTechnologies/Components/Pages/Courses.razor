@page "/courses"
@inject ICourseService CourseService
@inject NavigationManager Navigation
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]


<h3>Courses</h3>

@if (courses.Count == 0)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Название</th>
                <th>Описание</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var course in courses)
            {
                <tr>
                    <td>@course.Title</td>
                    <td>@course.Description</td>
                    <td>
                        <button class="btn btn-danger btn-sm" @onclick="@(() => DeleteCourse(course.Id))">Удалить</button>
                        <button class="btn btn-primary btn-sm" @onclick="@(() => ViewCourse(course.Id))">Просмотр</button>
                        <button class="btn btn-secondary btn-sm" @onclick="@(() => EditCourse(course.Id))">Редактировать</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    
}
<button class="btn btn-success" @onclick="CreateCourse">Создать курс</button>

@code {
    private List<Course> courses = new List<Course>();

    protected override async Task OnInitializedAsync()
    {
        var result = await CourseService.GetAllCoursesAsync();
        if (result is not null)
            courses = result;
    }

    private void ViewCourse(string id)
    {
        Navigation.NavigateTo($"/course/{id}");
    }

    private void EditCourse(string id)
    {
        Navigation.NavigateTo($"/course/edit/{id}");
    }

    private void CreateCourse()
    {
        Navigation.NavigateTo("/course/edit");
    }

    private async Task DeleteCourse(string id)
    {
        await CourseService.DeleteCourseAsync(id);
        courses = await CourseService.GetAllCoursesAsync();
    }
}
 